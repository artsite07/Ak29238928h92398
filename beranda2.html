<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8">
  <title>Beranda Pribadi - Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <link rel="icon" type="image/png" href="1.png">
  <!-- Menggunakan font Inter untuk tampilan modern -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- Firebase JS untuk data tugas -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <style>
    /* * Palet Warna Konsisten: Cyan dan Biru Gelap
    * --bg-dark: #1A2E40 (Latar Belakang Biru Gelap)
    * --bg-light: #2A4460 (Background Card)
    * --cyan-primary: #00BCD4 (Cyan Utama, Cerah)
    * --cyan-text: #E0F7FA (Teks Utama, Putih Kebiruan)
    * --subtle-cyan: #80DEEA (Aksen Subtil)
    * --shadow-color: rgba(0, 188, 212, 0.4); 
    */
    :root {
      --bg-dark: #1A2E40;
      --bg-light: #2A4460;
      --cyan-primary: #00BCD4;
      --cyan-text: #E0F7FA;
      --subtle-cyan: #80DEEA;
      --shadow-color: rgba(0, 188, 212, 0.4);
      --red-soft: #ef4444;
    }

    body {
      background-color: var(--bg-dark);
      color: var(--cyan-text);
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      box-sizing: border-box;
    }

    .container {
      max-width: 900px;
      width: 95%;
      padding: 40px 20px;
    }

    /* --- Bagian Jam (Widget) --- */
    .clock-widget {
      margin-bottom: 40px;
      text-align: center;
      /* Memastikan semua elemen jam di tengah */
    }

    #time-container {
      display: flex;
      justify-content: center;
      align-items: flex-end;
    }

    #time {
      font-size: 6rem;
      /* Ukuran besar untuk desktop */
      font-weight: 700;
      letter-spacing: 2px;
      color: var(--cyan-primary);
      text-shadow: 0 0 25px var(--shadow-color);
      line-height: 1;
    }

    #period {
      font-size: 2rem;
      font-weight: 300;
      color: var(--cyan-text);
      margin-left: 15px;
      line-height: 1.5;
    }

    #date {
      font-size: 1.2rem;
      color: var(--subtle-cyan);
      margin-top: 10px;
      font-weight: 400;
    }

    /* --- Bagian Daftar Tugas --- */
    .task-section {
      background: var(--bg-light);
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(0, 188, 212, 0.2);
      width: 100%;
      box-sizing: border-box;
    }

    .task-section h2 {
      font-size: 26px;
      color: var(--cyan-primary);
      border-bottom: 2px solid var(--subtle-cyan);
      padding-bottom: 10px;
      margin-top: 0;
      margin-bottom: 20px;
      font-weight: 600;
    }

    #taskList {
      list-style: none;
      padding: 0;
      margin: 0;
      max-height: 400px;
      /* Batasi tinggi untuk scroll */
      overflow-y: auto;
    }

    /* Scrollbar minimalis (Webkit) */
    #taskList::-webkit-scrollbar {
      width: 8px;
    }

    #taskList::-webkit-scrollbar-thumb {
      background: var(--cyan-primary);
      border-radius: 10px;
    }

    #taskList::-webkit-scrollbar-track {
      background: var(--bg-dark);
    }


    .task-item {
      background: var(--bg-dark);
      margin-bottom: 12px;
      padding: 15px;
      border-radius: 10px;
      display: flex;
      /* Atur display untuk menempatkan tombol di kanan */
      align-items: center;
      justify-content: space-between;
      transition: transform 0.2s, box-shadow 0.2s;
      border-left: 5px solid var(--cyan-primary);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }

    .task-details {
      display: flex;
      align-items: center;
      flex-grow: 1;
      margin-right: 15px;
      /* Ruang sebelum tombol */
    }

    .task-text {
      text-align: left;
      font-size: 1.1rem;
      font-weight: 400;
    }

    .task-count {
      background: var(--cyan-primary);
      color: var(--bg-dark);
      font-weight: 700;
      padding: 4px 8px;
      border-radius: 6px;
      margin-right: 15px;
      min-width: 25px;
      text-align: center;
    }

    /* Gaya untuk tombol Selesai */
    .complete-btn {
      background: transparent;
      color: var(--cyan-primary);
      border: 1px solid var(--cyan-primary);
      padding: 8px 15px;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.2s, color 0.2s, box-shadow 0.2s;
      font-weight: 600;
      min-width: 90px;
      flex-shrink: 0;
      /* Mencegah tombol mengecil */
    }

    .complete-btn:hover {
      background-color: var(--cyan-primary);
      color: var(--bg-dark);
      box-shadow: 0 0 10px var(--shadow-color);
    }

    #emptyMessage {
      text-align: center;
      color: var(--subtle-cyan);
      padding: 30px;
      font-style: italic;
    }

    /* Responsif */
    @media (max-width: 600px) {
      .container {
        padding: 20px 10px;
      }

      #time {
        font-size: 3.5rem;
      }

      #period {
        font-size: 1.2rem;
        margin-left: 10px;
      }

      #date {
        font-size: 1rem;
      }

      .task-section {
        padding: 20px;
      }

      .task-section h2 {
        font-size: 20px;
      }

      .task-item {
        padding: 12px;
        font-size: 1rem;
      }

      .task-details {
        /* Memastikan hitungan dan teks berada di satu baris */
        flex-wrap: nowrap;
        margin-right: 10px;
      }

      .task-count {
        margin-right: 10px;
        font-size: 0.9rem;
      }

      .complete-btn {
        min-width: 70px;
        padding: 6px 10px;
        font-size: 0.8rem;
      }
    }
  </style>
</head>

<body>
  <div class="container">

    <!-- 1. WIDGET JAM DAN TANGGAL -->
    <div class="clock-widget">
      <!-- Menghapus div id="greeting" -->
      <div id="time-container">
        <span id="time">00:00:00</span>
        <span id="period">AM</span>
      </div>
      <div id="date">Jumat, 27 September 2025</div>
    </div>

    <!-- 2. DAFTAR TUGAS AKTIF DENGAN TOMBOL SELESAI -->
    <div class="task-section">
      <h2>My Plan</h2>
      <ul id="taskList">
        <!-- Tugas akan dimuat di sini -->
      </ul>
      <div id="emptyMessage" style="display: none;">Nothing A Plans FOr Now, Time To Enjoying!</div>
    </div>

  </div>

  <script>
    // Konfigurasi Firebase dari file plan.html
    const firebaseConfig = {
      apiKey: "AIzaSyCba6M_spBXvuG91Zn-XWJ4bSTX6vNcST0",
      authDomain: "index-68220.firebaseapp.com",
      databaseURL: "https://index-68220-default-rtdb.firebaseio.com",
      projectId: "index-68220",
      storageBucket: "index-68220.firebasestorage.app",
      messagingSenderId: "633087068802",
      appId: "1:633087068802:web:f8aa1f2ef9c00b99d1429b",
      measurementId: "G-2VQCRFJQCM"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // =================================================================
    // Bagian 1: Logika Jam (Sapaan Dihapus)
    // =================================================================

    /**
     * Memperbarui jam dan tanggal secara real-time.
     */
    function updateClock() {
      const now = new Date();

      // Waktu
      let hours = now.getHours();
      const minutes = now.getMinutes().toString().padStart(2, '0');
      const seconds = now.getSeconds().toString().padStart(2, '0');

      // Format 12 jam
      const periodElement = document.getElementById('period');
      const period = hours >= 12 ? 'PM' : 'AM';
      let displayHours = hours % 12;
      displayHours = displayHours ? displayHours : 12; // Jam '0' menjadi '12'
      const timeString = displayHours.toString().padStart(2, '0') + ':' + minutes + ':' + seconds;

      document.getElementById('time').textContent = timeString;
      periodElement.textContent = period;

      // Tanggal
      const options = {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      };
      const dateString = now.toLocaleDateString('id-ID', options);
      document.getElementById('date').textContent = dateString;
    }

    // Mulai jam
    updateClock();
    setInterval(updateClock, 1000);

    // =================================================================
    // Bagian 2: Logika Tugas (Task List)
    // =================================================================

    const taskList = document.getElementById('taskList');
    const emptyMessage = document.getElementById('emptyMessage');

    /**
     * Menandai tugas sebagai selesai di Firebase.
     * Fungsi ini ditambahkan untuk mendukung tombol 'Selesai'.
     * @param {string} taskId - Kunci Firebase dari tugas yang akan diselesaikan.
     */
    window.completeTask = function(taskId) {
      // Menggunakan window.completeTask agar bisa dipanggil dari HTML onclick
      db.ref('plans/' + taskId).update({
        completed: true,
        completedAt: firebase.database.ServerValue.TIMESTAMP
      }).then(() => {
        // Tugas akan otomatis hilang dari daftar karena listener loadTasks
        console.log("Tugas berhasil diselesaikan:", taskId);
      }).catch(error => {
        console.error("Gagal menyelesaikan tugas:", error);
      });
    }


    /**
     * Memuat dan menampilkan tugas aktif dari Firebase.
     */
    function loadTasks() {
      // Menggunakan path 'plans' sesuai dengan plan.html
      db.ref('plans').on('value', snapshot => {
        taskList.innerHTML = '';
        const allTasks = [];

        // Ambil semua tugas
        snapshot.forEach(child => {
          const data = child.val();
          data.id = child.key; // Simpan kunci Firebase sebagai ID
          allTasks.push(data);
        });

        // Filter tugas yang belum selesai dan urutkan (Terbaru di atas)
        const activeTasks = allTasks.filter(task => !task.completed).reverse();

        if (activeTasks.length === 0) {
          emptyMessage.style.display = 'block';
          return;
        }

        emptyMessage.style.display = 'none';

        activeTasks.forEach((task, index) => {
          const li = document.createElement('li');
          li.className = 'task-item';
          li.innerHTML = `
                    <div class="task-details">
                        <div class="task-count">${index + 1}</div>
                        <div class="task-text">${task.text || 'Tugas tanpa deskripsi'}</div>
                    </div>
                    <button class="complete-btn" onclick="completeTask('${task.id}')">Selesai</button>
                `;
          taskList.appendChild(li);
        });
      });
    }

    // Mulai memuat tugas saat halaman dimuat
    loadTasks();

    // Proteksi akses (dipertahankan dari kode lain jika ada)
    // BLOK KODE INI DIHAPUS:
    /*
    (function() {
      try {
        const raw = sessionStorage.getItem('dashboard_access');
        if (!raw) {
          console.warn("No access token found. Proceeding.");
        }
      } catch (e) {
        console.error("Error accessing session storage:", e);
      }
    })();
    */
  </script>
</body>

</html>