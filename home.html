<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <title>Dashboard Rencana Pribadi</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3EðŸš€%3C/text%3E%3C/svg%3E">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap"
        rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dark-bg': '#0F172A',
                        'card-bg': '#1E293B',
                        'accent': '#38BDF8',
                        'text-light': '#F1F5F9',
                        'subtle-text': '#94A3B8',
                        'btn-hover': '#0EA5E9',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            overflow-y: auto;
        }

        body::-webkit-scrollbar,
        html::-webkit-scrollbar {
            display: none;
            width: 0;
            height: 0;
        }

        body {
            -ms-overflow-style: none;
        }

        body {
            scrollbar-width: none;
        }
    </style>
</head>

<body class="bg-dark-bg text-text-light min-h-screen p-4 sm:p-8 flex flex-col items-center font-sans antialiased">

    <div class="w-full max-w-4xl space-y-8">

        <div
            class="text-center p-6 bg-card-bg rounded-2xl shadow-lg border border-sky-400/20 transition duration-300">
            <div class="flex justify-center items-end">
                <span id="time"
                    class="text-6xl md:text-8xl font-extrabold text-accent leading-none tracking-tighter drop-shadow transition duration-300">00:00:00</span>
                <span id="period" class="text-xl md:text-3xl font-semibold ml-2 mb-1 text-subtle-text">AM</span>
            </div>
            <div id="date" class="text-md md:text-xl text-accent/70 mt-3 font-medium">Loading date...</div>
        </div>

        <div class="p-6 bg-card-bg rounded-2xl shadow-lg border border-sky-400/20">
            
            <ul id="taskList" class="space-y-3 mb-6 pt-1">
            </ul>

            <div id="emptyMessage" class="text-center py-8 text-subtle-text italic text-lg" style="display:none;">
                ðŸŽ‰ Semua rencana sudah selesai! Saatnya membuat yang baru.
            </div>

            <div class="mt-4 pt-4 border-t border-subtle-text/30">
                
                <div class="flex items-center space-x-3 mt-3">
                    <input type="text" id="taskInput" placeholder="Ketik rencana baru Anda di sini..."
                        class="flex-grow p-3 bg-dark-bg border border-accent/40 rounded-full text-text-light focus:outline-none focus:ring-2 focus:ring-accent placeholder:text-subtle-text text-base sm:text-lg"
                        onkeydown="if(event.key === 'Enter') document.getElementById('addTaskBtn').click()">
                    <button id="addTaskBtn"
                        class="p-3 font-bold bg-accent text-dark-bg rounded-full transition duration-200 shadow-lg flex items-center justify-center flex-shrink-0 w-12 h-12">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
                                clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
                <p id="errorMsg" class="text-red-500 mt-2 ml-4 hidden text-sm"></p>
            </div>
        </div>

    </div>


    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCba6M_spBXvuG91Zn-XWJ4bSTX6vNcST0",
            authDomain: "index-68220.firebaseapp.com",
            databaseURL: "https://index-68220-default-rtdb.firebaseio.com",
            projectId: "index-68220",
            storageBucket: "index-68220.firebasestorage.app",
            messagingSenderId: "633087068802",
            appId: "1:633087068802:web:f8aa1f2ef9c00b99d1429b",
            measurementId: "G-2VQCRFJQCM"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let lastTime = 0;
        const updateInterval = 1000;

        function updateClock(timestamp) {
            if (!lastTime || timestamp - lastTime >= updateInterval) {
                lastTime = timestamp;

                const now = new Date();
                let h = now.getHours();
                const m = now.getMinutes().toString().padStart(2, '0');
                const s = now.getSeconds().toString().padStart(2, '0');
                const period = h >= 12 ? 'PM' : 'AM';
                h = h % 12 || 12;

                document.getElementById('time').textContent = `${h.toString().padStart(2,'0')}:${m}:${s}`;
                document.getElementById('period').textContent = period;
                document.getElementById('date').textContent = now.toLocaleDateString('id-ID', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }

            requestAnimationFrame(updateClock);
        }

        requestAnimationFrame(updateClock);

        const taskList = document.getElementById('taskList');
        const emptyMessage = document.getElementById('emptyMessage');
        const taskInput = document.getElementById('taskInput');
        const addTaskBtn = document.getElementById('addTaskBtn');
        const errorMsg = document.getElementById('errorMsg');

        function completeTask(id) {
            db.ref('plans/' + id).remove()
                .then(() => {
                    console.log(`Task ${id} berhasil dihapus.`);
                })
                .catch(err => {
                    console.error('Gagal menghapus task:', err);
                });
        }

        addTaskBtn.addEventListener('click', () => {
            const text = taskInput.value.trim();
            errorMsg.classList.add('hidden');

            if (text === "") {
                errorMsg.textContent = "Rencana tidak boleh kosong!";
                errorMsg.classList.remove('hidden');
                return;
            }

            db.ref('plans').push({
                text: text,
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                completed: false
            })
                .then(() => {
                    taskInput.value = '';
                })
                .catch(err => {
                    errorMsg.textContent = `Gagal menyimpan rencana: ${err.message}`;
                    errorMsg.classList.remove('hidden');
                    console.error('Gagal menyimpan task:', err);
                });
        });

        function loadTasks() {
            db.ref('plans').on('value', snap => {
                const all = [];
                snap.forEach(c => {
                    const d = c.val();
                    d.id = c.key;
                    all.push(d);
                });

                all.sort((a, b) => b.timestamp - a.timestamp);

                const active = all.filter(t => !t.completed);

                if (!active.length) {
                    emptyMessage.style.display = 'block';
                    taskList.style.display = 'none';
                    taskList.innerHTML = '';
                    return;
                }

                emptyMessage.style.display = 'none';
                taskList.style.display = 'block';

                const fragment = document.createDocumentFragment();

                active.forEach((t, i) => {
                    const li = document.createElement('li');
                    li.className = 'flex justify-between items-start p-3 sm:p-4 bg-card-bg/70 rounded-xl shadow-md border border-accent/20 transition duration-200';

                    const button = document.createElement('button');
                    button.className = 'complete-btn w-8 h-8 p-1.5 border border-accent text-accent rounded-full transition duration-200 flex items-center justify-center flex-shrink-0 ml-2';

                    button.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.857a.75.75 0 00-1.214-.856l-3.214 4.5V11.25a.75.75 0 00-1.5 0v3a.75.75 0 00.75.75h3.75a.75.75 0 000-1.5h-1.443l3.214-4.5z" clip-rule="evenodd" />
                        </svg>
                    `;

                    button.addEventListener('click', () => completeTask(t.id));


                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'flex items-start flex-grow min-w-0';
                    contentDiv.innerHTML = `
                        <div class="task-count w-7 h-7 sm:w-8 sm:h-8 flex items-center justify-center text-xs sm:text-sm font-bold bg-accent text-dark-bg rounded-full mr-3 sm:mr-4 flex-shrink-0 shadow-sm">
                            ${i + 1}
                        </div>
                        <div class="task-text text-base sm:text-lg font-medium text-text-light break-words w-full pt-0.5">
                            ${t.text || 'Tidak ada deskripsi'}
                        </div>
                    `;

                    li.appendChild(contentDiv);
                    li.appendChild(button);
                    fragment.appendChild(li);
                });

                taskList.innerHTML = '';
                taskList.appendChild(fragment);
            });
        }
        loadTasks();
    </script>

</body>

</html>
