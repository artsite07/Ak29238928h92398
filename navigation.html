<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Manajemen Navigasi</title>
  <link rel="icon" href="1.png" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

  <style>
    :root {
      --bg-dark: #111827;
      --card-bg: #1f2937;
      --cyan-start: #0088cc;
      --cyan-end: #00d4ff;
      --text-color: #e2e8f0;
      --muted-text: #94a3b8;
      --border-color: rgba(255, 255, 255, 0.1);
      --red-soft: #ef4444;
      --green-soft: #10b981;
      --reorder-bg: #374151;
    }

    body {
      margin: 0;
      padding: 30px;
      background: var(--bg-dark);
      color: var(--text-color);
      font-family: 'Inter', sans-serif;
      min-height: 100vh;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: var(--card-bg);
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
    }

    h1 {
      font-size: 1.8rem;
      font-weight: 700;
      margin-top: 0;
      border-bottom: 2px solid var(--border-color);
      padding-bottom: 10px;
      background-image: linear-gradient(90deg, var(--cyan-start), var(--cyan-end));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    h2.category-title {
      font-size: 1.4rem;
      font-weight: 600;
      color: var(--text-color);
      margin-top: 25px;
      margin-bottom: 15px;
      padding-bottom: 5px;
      border-bottom: 1px dashed var(--muted-text);
    }

    .form-input-group {
      border: 1px solid var(--border-color);
      padding: 20px;
      margin-bottom: 30px;
      border-radius: 10px;
    }

    .form-input {
      display: grid;
      grid-template-columns: 1fr 2fr auto;
      gap: 12px;
      margin-top: 15px;
    }

    .form-input input {
      padding: 12px 16px;
      border: 1px solid var(--border-color);
      background: #334155;
      color: var(--text-color);
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.3s, box-shadow 0.3s;
    }

    .form-input input:focus {
      outline: none;
      border-color: var(--cyan-end);
      box-shadow: 0 0 5px rgba(0, 212, 255, 0.5);
    }

    .form-input button {
      padding: 12px 24px;
      background: linear-gradient(90deg, var(--cyan-start), var(--cyan-end));
      color: var(--bg-dark);
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 1rem;
      transition: opacity 0.3s, transform 0.1s;
      box-shadow: 0 4px 10px rgba(0, 212, 255, 0.3);
    }

    .form-input button:hover {
      opacity: 0.9;
    }

    .form-input button:active {
      transform: translateY(1px);
    }

    .nav-list {
      list-style: none;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 0;
    }

    .nav-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background: #2b3a4a;
      border-radius: 10px;
      border-left: 4px solid var(--cyan-start);
      transition: background 0.3s, border-left-color 0.3s;
      flex-wrap: wrap;
      cursor: grab;
    }

    .nav-item:hover {
      background: #334155;
    }

    .sortable-chosen {
      background: var(--reorder-bg) !important;
      border-left: 4px solid var(--cyan-end) !important;
      box-shadow: 0 5px 15px rgba(0, 212, 255, 0.3);
      opacity: 1 !important;
    }

    .sortable-ghost {
      opacity: 0.4;
      background: #374151;
    }

    .nav-info {
      flex-grow: 1;
      min-width: 50%;
    }

    .nav-info .name {
      font-weight: 600;
      font-size: 1.05rem;
      color: var(--text-color);
      word-break: break-word;
    }

    .nav-info .link {
      font-size: 0.8rem;
      color: var(--muted-text);
      word-break: break-all;
    }

    .nav-actions {
      display: flex;
      gap: 10px;
      margin-left: 20px;
      flex-shrink: 0;
    }

    .nav-actions button {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      font-size: 0.9rem;
      transition: opacity 0.3s, background 0.3s;
    }

    .nav-actions button.edit {
      background: var(--green-soft);
      color: white;
    }

    .nav-actions button.edit:hover {
      background: #059669;
    }

    .nav-actions button.del {
      background-color: var(--red-soft);
      color: white;
    }

    .nav-actions button.del:hover {
      background-color: #dc2626;
    }

    .edit-mode .nav-info {
      display: none;
    }

    .edit-fields {
      flex-grow: 1;
      display: none;
      gap: 10px;
      flex-wrap: wrap;
    }

    .edit-mode .edit-fields {
      display: flex;
    }

    .edit-fields input {
      padding: 8px;
      border: 1px solid var(--cyan-start);
      background: #334155;
      color: var(--text-color);
      border-radius: 4px;
      font-size: 0.9rem;
    }

    .edit-fields .name-input {
      flex: 1 1 30%;
    }

    .edit-fields .link-input {
      flex: 2 1 60%;
    }

    @media (max-width: 768px) {
      .form-input {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto auto;
      }

      .nav-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .nav-actions {
        margin-left: 0;
      }

      .edit-mode .edit-fields {
        flex-direction: column;
      }

      .edit-fields input {
        width: 100%;
      }
    }

    /* --- Popup Delete --- */
    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(17, 24, 39, 0.9);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .popup {
      background: var(--card-bg);
      border: 2px solid var(--cyan-start);
      border-radius: 12px;
      padding: 25px;
      text-align: center;
      color: var(--text-color);
    }

    .popup-actions button {
      margin: 8px;
      padding: 10px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
    }

    #confirmDelete {
      background: var(--red-soft);
      color: white;
    }

    #confirmDelete:hover {
      background: #dc2626;
    }

    #cancelDelete {
      background: #334155;
      color: var(--cyan-start);
    }

    #cancelDelete:hover {
      border-color: var(--cyan-end);
      color: var(--cyan-end);
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Kelola Navigasi</h1>
    <p style="color:var(--muted-text); margin-bottom:25px;">Drag & Drop item untuk mengurutkannya. Urutan akan tersimpan otomatis.</p>

    <h2 class="category-title">Navigasi Utama</h2>
    <div class="form-input-group">
        <p style="color:var(--muted-text); margin-bottom: 0;">Tambah Menu Navigasi Utama</p>
        <div class="form-input">
            <input type="text" id="navNameUtama" placeholder="Nama Menu (misal: Beranda)" />
            <input type="text" id="navLinkUtama" placeholder="Link (misal: beranda.html)" />
            <button onclick="addNav('utama')">Tambah</button>
        </div>
    </div>
    <ul class="nav-list" id="navListUtama">
      <li style="opacity:.6; color: var(--muted-text); text-align:center;">Memuat daftar navigasi...</li>
    </ul>

    <hr style="border: 0; height: 1px; background: var(--border-color); margin: 30px 0;" />

    <h2 class="category-title">Navigasi Sekunder</h2>
    <div class="form-input-group">
        <p style="color:var(--muted-text); margin-bottom: 0;">Tambah Menu Navigasi Sekunder</p>
        <div class="form-input">
            <input type="text" id="navNameSekunder" placeholder="Nama Menu (misal: Kontak)" />
            <input type="text" id="navLinkSekunder" placeholder="Link (misal: kontak.html)" />
            <button onclick="addNav('sekunder')">Tambah</button>
        </div>
    </div>
    <ul class="nav-list" id="navListSekunder">
      <li style="opacity:.6; color: var(--muted-text); text-align:center;">Memuat daftar navigasi sekunder...</li>
    </ul>

  </div>

  <div class="popup-overlay" id="deleteOverlay">
    <div class="popup">
      <h3>Konfirmasi Hapus</h3>
      <p id="deleteMessage">Anda yakin ingin menghapus item ini?</p>
      <div class="popup-actions">
        <button id="confirmDelete">Hapus</button>
        <button id="cancelDelete">Batal</button>
      </div>
    </div>
  </div>

  <script>
    // --- Firebase ---
    const firebaseConfig = {
      apiKey: "AIzaSyCba6M_spBXvuG91Zn-XWJ4bSTX6vNcST0",
      authDomain: "index-68220.firebaseapp.com",
      databaseURL: "https://index-68220-default-rtdb.firebaseio.com",
      projectId: "index-68220",
      storageBucket: "index-68220.firebasestorage.app",
      messagingSenderId: "633087068802",
      appId: "1:633087068802:web:f8aa1f2ef9c00b99d1429b",
      measurementId: "G-2VQCRFJQCM"
    };

    if (typeof firebase !== 'undefined' && !firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database ? firebase.database() : null;

    // Definisikan referensi untuk kedua kategori
    const refs = {
      utama: {
        name: 'Navigasi Utama',
        ref: db ? db.ref("navigation") : null,
        listEl: document.getElementById("navListUtama"),
        nameInput: document.getElementById("navNameUtama"),
        linkInput: document.getElementById("navLinkUtama"),
      },
      sekunder: {
        name: 'Navigasi Sekunder',
        ref: db ? db.ref("secondaryNavigation") : null, // LOKASI BARU DI FIREBASE
        listEl: document.getElementById("navListSekunder"),
        nameInput: document.getElementById("navNameSekunder"),
        linkInput: document.getElementById("navLinkSekunder"),
      }
    };

    let isReordering = {
      utama: false,
      sekunder: false
    };

    let deleteId = null;
    let deleteCategory = null;

    function escapeHTML(s) {
      return String(s).replace(/&/g, '&amp;').replace(/</g, '&lt;');
    }

    // --- CRUD Reusable Functions ---

    // Tambah Navigasi
    function addNav(category) {
      const data = refs[category];
      if (!data.ref) return;

      const name = data.nameInput.value.trim();
      const link = data.linkInput.value.trim();
      if (!name || !link) {
        alert(`Nama dan Link wajib diisi untuk ${data.name}.`);
        return;
      }

      data.ref.limitToLast(1).once('value', snapshot => {
        let nextOrder = 1;
        snapshot.forEach(child => {
          if (child.val().order) nextOrder = child.val().order + 1;
        });

        data.ref.push({
          name,
          link,
          order: nextOrder
        }).then(() => {
          data.nameInput.value = "";
          data.linkInput.value = "";
        }).catch(console.error);
      }, console.error);
    }

    // Hapus Navigasi
    function delNav(id, category) {
      const item = document.getElementById(`nav-item-${category}-${id}`);
      const name = item.querySelector('.name').textContent;

      deleteId = id;
      deleteCategory = category;
      document.getElementById('deleteMessage').innerHTML = `Yakin ingin menghapus item <strong>${name}</strong> dari <strong>${refs[category].name}</strong>?`;
      document.getElementById('deleteOverlay').style.display = 'flex';
    }

    document.getElementById('confirmDelete').onclick = () => {
      if (!deleteId || !deleteCategory) return;
      refs[deleteCategory].ref.child(deleteId).remove().catch(console.error);
      document.getElementById('deleteOverlay').style.display = 'none';
      deleteId = null;
      deleteCategory = null;
    }

    document.getElementById('cancelDelete').onclick = () => {
      document.getElementById('deleteOverlay').style.display = 'none';
      deleteId = null;
      deleteCategory = null;
    }

    // Simpan Edit
    function saveEdit(id, category) {
      const data = refs[category];
      const item = document.getElementById(`nav-item-${category}-${id}`);
      if (!item) return;
      const newName = item.querySelector('.name-input').value.trim();
      const newLink = item.querySelector('.link-input').value.trim();
      if (!newName || !newLink) {
        alert('Nama dan Link wajib diisi.');
        return;
      }

      data.ref.child(id).update({
        name: newName,
        link: newLink
      }).then(() => {
        item.classList.remove('edit-mode');
        const btn = item.querySelector('.edit');
        btn.textContent = 'Edit';
        btn.style.backgroundColor = 'var(--green-soft)';
      }).catch(console.error);
    }

    // Toggle Edit Mode
    function handleEditClick(id, category, button) {
      const item = document.getElementById(`nav-item-${category}-${id}`);
      if (!item) return;

      if (!item.classList.contains('edit-mode')) {
        const currentName = item.querySelector('.nav-info .name').textContent;
        const currentLink = item.querySelector('.nav-info .link').textContent.split(' (Order:')[0];
        item.querySelector('.name-input').value = currentName;
        item.querySelector('.link-input').value = currentLink;
        item.classList.add('edit-mode');

        button.textContent = 'Simpan';
        button.style.backgroundColor = 'var(--cyan-start)';
      } else {
        saveEdit(id, category);
      }
    }

    // Update Order (Sortable onEnd)
    function updateOrder(sortableList) {
      const category = sortableList.id === 'navListUtama' ? 'utama' : 'sekunder';
      const data = refs[category];
      if (!data.ref) return;

      isReordering[category] = true;
      const updates = {};
      Array.from(sortableList.children).forEach((li, index) => {
        const id = li.dataset.id;
        updates[id + '/order'] = index + 1;
      });

      data.ref.update(updates).then(() => {
        setTimeout(() => isReordering[category] = false, 500);
      }).catch(() => {
        isReordering[category] = false;
      });
    }

    // Render Item (Reusable)
    function renderNav(snap, category) {
      const data = refs[category];
      if (isReordering[category]) return;

      data.listEl.innerHTML = "";
      if (!snap.exists()) {
        data.listEl.innerHTML = `<li style='opacity:.6; color: var(--muted-text); text-align: center; padding:15px;'>Tidak ada menu ${data.name} yang tersimpan.</li>`;
        return;
      }

      snap.forEach(child => {
        const id = child.key;
        const d = child.val();
        const orderDisplay = d.order === undefined ? '?' : d.order;
        const li = document.createElement("li");
        li.className = "nav-item";
        li.id = `nav-item-${category}-${id}`; // ID unik per kategori
        li.dataset.id = id;
        li.innerHTML = `
            <div class="nav-info">
              <div class="name">${escapeHTML(d.name||'Nama Kosong')}</div>
              <div class="link">${escapeHTML(d.link||'#')} (Order: ${orderDisplay})</div>
            </div>
            <div class="edit-fields">
              <input type="text" class="name-input" placeholder="Nama" />
              <input type="text" class="link-input" placeholder="Link" />
            </div>
            <div class="nav-actions">
              <button class="edit" onclick="handleEditClick('${id}', '${category}', this)">Edit</button>
              <button class="del" onclick="delNav('${id}', '${category}')">Hapus</button>
            </div>`;
        data.listEl.appendChild(li);
      });
    }

    // --- Inisialisasi ---
    window.onload = () => {
      if (typeof Sortable !== 'undefined') {
        // Sortable untuk Navigasi Utama
        Sortable.create(refs.utama.listEl, {
          animation: 150,
          handle: '.nav-item',
          onEnd: evt => updateOrder(evt.from)
        });

        // Sortable untuk Navigasi Sekunder
        Sortable.create(refs.sekunder.listEl, {
          animation: 150,
          handle: '.nav-item',
          onEnd: evt => updateOrder(evt.from)
        });
      }

      // Listener untuk Firebase Navigasi Utama
      if (refs.utama.ref) {
        refs.utama.ref.orderByChild('order').on("value", snap => renderNav(snap, 'utama'));
        refs.utama.linkInput.addEventListener("keypress", e => {
            if (e.key === "Enter") addNav('utama');
        });
      }

      // Listener untuk Firebase Navigasi Sekunder
      if (refs.sekunder.ref) {
        refs.sekunder.ref.orderByChild('order').on("value", snap => renderNav(snap, 'sekunder'));
        refs.sekunder.linkInput.addEventListener("keypress", e => {
            if (e.key === "Enter") addNav('sekunder');
        });
      }
    };
    
    // Global Key Handlers
    document.addEventListener('keydown', e => {
        // Handle Popup Delete
        const overlayVisible = document.getElementById('deleteOverlay').style.display === 'flex';
        if (overlayVisible) {
            if (e.key === 'Escape') document.getElementById('cancelDelete').click();
            if (e.key === 'Enter') document.getElementById('confirmDelete').click();
        }

        // Handle Edit Mode
        const editingItem = document.querySelector('.nav-item.edit-mode');
        if (editingItem) {
            const id = editingItem.getAttribute('data-id');
            const category = editingItem.closest('#navListUtama') ? 'utama' : 'sekunder';

            if (e.key === 'Escape') {
                editingItem.classList.remove('edit-mode');
                const btn = editingItem.querySelector('.edit');
                btn.textContent = 'Edit';
                btn.style.backgroundColor = 'var(--green-soft)';
            }
            if (e.key === 'Enter') {
                saveEdit(id, category);
            }
        }
    });
  </script>
</body>

</html>
